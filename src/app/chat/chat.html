<div *ngIf="!isReady" class="loading">
  Loading chat...
</div>

<!-- Make ENTIRE SCREEN a vertical flex container -->
<div class="vh-100 d-flex flex-column overflow-hidden">

  <!-- ===== MOBILE TOP BAR WITH HAMBURGER ===== -->
  <nav class="navbar bg-dark text-white d-md-none px-3 flex-shrink-0">
    <button 
      class="bg-dark border-0 text-white"
      data-bs-toggle="offcanvas"
      data-bs-target="#usersDrawer"
      style="font-size: 22px;">
      â˜° &nbsp;&nbsp;Chats
    </button>
  </nav>

  <!-- Main content fills remaining space -->
  <div class="container-fluid p-0 flex-grow-1 overflow-hidden">
    <div class="d-flex h-100">

      <!-- LEFT PANEL (USERS) â€” visible only on desktop -->
      <div class="users d-none d-md-block">
        <h3>ðŸ’¬ Users</h3>

        <div *ngFor="let u of users"
             (click)="selectUser(u)"
             class="user-item"
             [class.active]="u === selectedUser">
          {{u.name}}
        </div>
      </div>

      <!-- ===== USERS OFFCANVAS (MOBILE DRAWER) ===== -->
      <div class="offcanvas offcanvas-start" tabindex="-1" id="usersDrawer">
        <div class="offcanvas-header bg-dark text-white">
          <h5 class="offcanvas-title">ðŸ’¬ Users</h5>
          <button type="button" class="bg-dark text-white border-0" data-bs-dismiss="offcanvas">X</button>
        </div>

        <div class="offcanvas-body bg-dark text-white">
          <div *ngFor="let u of users"
               (click)="selectUser(u)"
               data-bs-dismiss="offcanvas"
               class="p-2 mb-2 rounded"
               [class.bg-primary]="u === selectedUser"
               style="cursor:pointer;">
            {{u.name}}
          </div>
        </div>
      </div>

      <!-- RIGHT PANEL (CHAT) -->
      <div class="chat flex-grow-1 d-flex flex-column overflow-hidden">

        <div class="chat-header flex-shrink-0">
          <h3>Logged in as: <span>{{username}}</span></h3>
          <h4>Chat with: <span>{{selectedUser?.name || 'Select a user'}}</span></h4>

          <button class="btn btn-danger btn-sm mt-2" (click)="logout()">
            Logout
          </button>
        </div>

        <!-- ONLY THIS PART SCROLLS -->
        <div class="messages flex-grow-1 overflow-auto" #scrollMe>

          <div *ngFor="let m of messages"
               [ngClass]="{'mine': m.includes('You:') || m.includes(username), 
                           'other': !(m.includes('You:') || m.includes(username))}">

            <div class="sender">
              {{ (m.includes('You:') || m.includes(username)) ? 'You' : selectedUser?.name }}
            </div>

            <div class="text">
              {{
                m
                .replace(username + ':', '')
                .replace(selectedUser?.name + ':', '')
                .replace('You:', '')
                .trim()
              }}
            </div>

          </div>
        </div>

        <!-- Input stays visible, not pushed down -->
        <div class="input-area flex-shrink-0">
          <input [(ngModel)]="message" placeholder="Type message..." />
          <button 
            type="button"
            (mousedown)="$event.preventDefault()" 
            (click)="send()">
            Send
          </button>
        </div>

      </div>
    </div>
  </div>
</div>